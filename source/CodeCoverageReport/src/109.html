<html>
	<head>
		<script type="text/javascript" src="../js/coverreport.js">

		</script><script type="text/javascript">
			RANGES_109 = [
   [33,13,33,64,'dccv']
, [33,13,33,64,'dccv']
, [32,78,32,79,'dccv']
, [34,13,34,69,'dccv']
, [35,13,35,44,'dccv']
, [36,9,36,10,'dccv']
, [45,13,45,119,'dccv']
, [45,13,45,119,'dccv']
, [44,102,44,103,'dccv']
, [46,13,46,80,'dccv']
, [47,13,47,44,'dccv']
, [48,9,48,10,'dccv']
, [57,13,57,119,'dccv']
, [57,13,57,119,'dccv']
, [56,104,56,105,'dccv']
, [58,13,58,43,'dccv']
, [58,44,58,45,'dccv']
, [59,17,59,46,'dccv']
, [60,13,60,14,'dccv']
, [61,9,61,10,'dccv']
, [70,13,70,96,'dccv']
, [81,13,81,64,'dccv']
, [81,13,81,64,'dccv']
, [80,81,80,82,'dccv']
, [82,13,82,69,'dccv']
, [83,13,83,44,'dccv']
, [84,9,84,10,'dccv']
, [93,13,93,119,'dccv']
, [93,13,93,119,'dccv']
, [92,101,92,102,'dccv']
, [94,13,94,60,'dccv']
, [95,13,95,32,'dccv']
, [97,13,97,46,'dccv']
, [97,47,97,48,'dccv']
, [98,17,98,48,'dccv']
, [99,17,99,53,'dccv']
, [100,17,100,42,'dccv']
, [101,17,101,57,'dccv']
, [102,17,102,44,'dccv']
, [103,17,103,38,'dccv']
, [104,13,104,14,'dccv']
, [108,9,108,10,'dccv']
, [115,13,115,45,'dccv']
, [114,60,114,61,'dccv']
, [117,13,117,128,'dccv']
, [117,145,117,159,'dccv']
, [119,13,119,38,'dccv']
, [119,39,119,40,'dccv']
, [120,17,120,35,'dccv']
, [121,17,121,24,'dccv']
, [121,40,121,57,'dccv']
, [121,26,121,36,'dccv']
, [121,59,121,60,'dccv']
, [122,21,122,39,'dccv']
, [123,21,123,51,'dccv']
, [124,17,124,18,'dccv']
, [121,37,121,39,'dccv']
, [125,13,125,14,'dccv']
, [126,9,126,10,'dccv']
, [133,13,133,70,'dccv']
, [133,13,133,70,'dccv']
, [132,55,132,56,'dccv']
, [134,13,134,34,'dccv']
, [136,13,136,88,'dccv']
, [137,13,137,93,'dccv']
, [139,13,139,136,'dccv']
, [140,13,140,20,'dccv']
, [140,36,140,53,'dccv']
, [140,21,140,32,'dccv']
, [140,55,140,56,'dccv']
, [141,17,141,48,'dccv']
, [142,13,142,14,'dccv']
, [140,33,140,35,'dccv']
, [144,13,144,48,'dccv']
, [145,9,145,10,'dccv']
, [152,13,152,45,'dccv']
, [151,58,151,59,'dccv']
, [154,13,156,87,'dccv']
, [157,13,157,100,'dccv']
, [158,13,158,71,'dccv']
, [160,13,160,20,'dccv']
, [160,36,160,53,'dccv']
, [171,13,171,100,'dccv']
, [171,13,171,100,'dccv']
, [170,74,170,75,'dccv']
, [172,13,172,60,'dccv']
, [173,13,173,31,'dccv']
, [177,13,177,57,'dccv']
, [178,13,178,32,'dccv']
, [182,13,182,51,'dccv']
, [183,13,183,29,'dccv']
, [187,13,187,35,'dccv']
, [189,13,189,96,'dccv']
, [191,13,191,82,'dccv']
, [192,13,192,44,'dccv']
, [194,13,194,73,'dccv']
, [194,74,194,75,'dccv']
, [195,17,195,35,'dccv']
, [196,13,196,14,'dccv']
, [197,9,197,10,'dccv']
, [205,13,205,64,'dccv']
, [205,13,205,64,'dccv']
, [204,79,204,80,'dccv']
, [206,13,206,74,'dccv']
, [207,13,207,69,'dccv']
, [208,13,208,44,'dccv']
, [209,9,209,10,'dccv']
, [217,13,217,100,'dccv']
, [217,13,217,100,'dccv']
, [216,74,216,75,'dccv']
, [218,13,218,64,'dccv']
, [219,13,219,60,'dccv']
, [220,13,220,51,'dccv']
, [222,13,222,81,'dccv']
, [230,13,230,79,'dccv']
, [232,13,233,106,'dccv']
, [235,13,235,20,'dccv']
, [235,36,235,53,'dccv']
, [235,21,235,32,'dccv']
, [235,55,235,56,'dccv']
, [236,17,236,48,'dccv']
, [237,13,237,14,'dccv']
, [235,33,235,35,'dccv']
, [239,13,239,35,'dccv']
, [241,13,241,42,'dccv']
, [241,43,241,44,'dccv']
, [242,17,242,88,'dccv']
, [243,13,243,14,'dccv']
, [243,19,243,20,'dccv']
, [244,17,244,38,'dccv']
, [245,13,245,14,'dccv']
, [246,9,246,10,'dccv']
, [253,13,253,45,'dccv']
, [252,57,252,58,'dccv']
, [255,13,255,69,'dccv']
, [256,13,256,20,'dccv']
, [256,36,256,53,'dccv']
, [256,21,256,32,'dccv']
, [256,55,256,56,'dccv']
, [257,17,257,48,'dccv']
, [258,13,258,14,'dccv']
, [256,33,256,35,'dccv']
, [259,9,259,10,'dccv']
, [268,13,268,148,'dccv']
, [268,13,268,148,'dccv']
, [267,96,267,97,'dccv']
, [270,13,270,35,'dccv']
, [270,36,270,37,'dccv']
, [271,17,271,29,'dccv']
, [272,17,272,53,'dccv']
, [272,54,272,55,'dccv']
, [273,21,273,40,'dccv']
, [274,17,274,18,'dccv']
, [278,17,278,46,'dccv']
, [278,47,278,48,'dccv']
, [279,21,279,38,'dccv']
, [280,17,280,18,'dccv']
, [281,13,281,14,'dccv']
, [282,9,282,10,'dccv']
, [289,13,289,45,'dccv']
, [288,54,288,55,'dccv']
, [291,13,294,81,'dccv']
, [295,13,295,71,'dccv']
, [296,13,296,20,'dccv']
, [296,37,296,54,'dccv']
, [296,22,296,33,'dccv']
, [296,56,296,57,'dccv']
, [297,17,297,48,'dccv']
, [298,13,298,14,'dccv']
, [296,34,296,36,'dccv']
, [299,13,299,80,'dccv']
, [300,9,300,10,'dccv']
, [307,13,307,73,'dccv']
, [307,13,307,73,'dccv']
, [306,56,306,57,'dccv']
, [309,13,309,46,'dccv']
, [310,13,310,20,'dccv']
, [310,35,310,52,'dccv']
, [310,21,310,31,'dccv']
, [310,54,310,55,'dccv']
, [311,17,311,68,'dccv']
, [312,13,312,14,'dccv']
, [310,32,310,34,'dccv']
, [313,13,313,82,'dccv']
, [315,13,315,100,'dccv']
, [317,13,317,20,'dccv']
, [317,35,317,52,'dccv']
, [317,21,317,31,'dccv']
, [317,54,317,55,'dccv']
, [318,17,318,47,'dccv']
, [319,13,319,14,'dccv']
, [317,32,317,34,'dccv']
, [320,13,320,35,'dccv']
, [320,36,320,37,'dccv']
, [321,17,321,41,'dccv']
, [322,13,322,14,'dccv']
, [323,9,323,10,'dccv']
, [330,13,330,45,'dccv']
, [329,53,329,54,'dccv']
, [332,13,332,106,'dccv']
, [333,13,333,116,'dccv']
, [334,13,334,71,'dccv']
, [336,13,336,20,'dccv']
, [336,35,336,52,'dccv']
, [336,21,336,31,'dccv']
, [336,54,336,55,'dccv']
, [337,17,337,47,'dccv']
, [338,13,338,14,'dccv']
, [336,32,336,34,'dccv']
, [339,9,339,10,'dccv']
, [346,13,346,45,'dccv']
, [345,59,345,60,'dccv']
, [348,13,350,113,'dccv']
, [351,13,351,71,'dccv']
, [353,13,353,20,'dccv']
, [353,36,353,53,'dccv']
, [353,22,353,32,'dccv']
, [353,55,353,56,'dccv']
, [354,17,354,47,'dccv']
, [355,13,355,14,'dccv']
, [353,33,353,35,'dccv']
, [356,9,356,10,'dccv']
, [117,128,117,145,'dccv']
, [70,13,70,96,'dcuc']
, [69,99,69,100,'dcuc']
, [71,13,71,83,'dcuc']
, [72,13,72,44,'dcuc']
, [73,9,73,10,'dcuc']
, [95,33,95,40,'dcuc']
, [98,49,98,81,'dcuc']
, [104,19,104,20,'dcuc']
, [105,17,105,110,'dcuc']
, [106,17,106,48,'dcuc']
, [107,13,107,14,'dcuc']
, [120,36,120,80,'dcuc']
, [122,40,122,78,'dcuc']
, [160,22,160,32,'dcuc']
, [160,55,160,56,'dcuc']
, [161,17,161,47,'dcuc']
, [162,13,162,14,'dcuc']
, [160,33,160,35,'dcuc']
, [163,9,163,10,'dcuc']
, [173,32,173,33,'dcuc']
, [174,17,174,24,'dcuc']
, [178,33,178,34,'dcuc']
, [179,17,179,24,'dcuc']
, [183,30,183,31,'dcuc']
, [184,17,184,24,'dcuc']
, [222,82,222,83,'dcuc']
, [223,17,223,73,'dcuc']
, [224,17,224,93,'dcuc']
, [225,17,225,54,'dcuc']
, [226,17,226,43,'dcuc']
, [227,17,227,24,'dcuc']
, [274,24,274,25,'dcuc']
, [275,21,275,72,'dcuc']
, [276,17,276,18,'dcuc']
];
		</script><link rel="stylesheet" type="text/css" href="../css/coverreport.css" />
	</head><body>
		<code id="src109" class="dotCoverSource"><pre>// &lt;copyright file=&quot;PirateHostCommands.cs&quot;&gt;
//      ahal@itu.dk
// &lt;/copyright&gt;
// &lt;summary&gt;
//      Various commands used by the PirateHost to communicate with its clients (PirateClient).
// &lt;/summary&gt;
// &lt;author&gt;Andreas Hallberg Kjeldsen (ahal@itu.dk)&lt;/author&gt;

namespace PirateSpades.Network {
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Diagnostics.Contracts;

    using PirateSpades.GameLogic;
    using PirateSpades.Misc;

    /// &lt;summary&gt;
    /// Various commands used by the PirateHost to communicate with its clients (PirateClient).
    /// &lt;/summary&gt;
    public class PirateHostCommands {
        /// &lt;summary&gt;
        /// A small text for identifying valid clients.
        /// &lt;/summary&gt;
        private const string WelcomePhrase = &quot;YARRR!!&quot;;

        /// &lt;summary&gt;
        /// Reply to a knock.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        /// &lt;param name=&quot;pclient&quot;&gt;The client.&lt;/param&gt;
        public static void KnockKnock(PirateHost host, PirateClient pclient) {
            Contract.Requires(host != null &amp;&amp; pclient != null);
            var msg = new PirateMessage(PirateMessageHead.Knck, &quot;&quot;);
            host.SendMessage(pclient, msg);
        }

        /// &lt;summary&gt;
        /// Reply to a connection initialization.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        /// &lt;param name=&quot;pclient&quot;&gt;The client.&lt;/param&gt;
        /// &lt;param name=&quot;data&quot;&gt;The data received from the client.&lt;/param&gt;
        public static void InitConnection(PirateHost host, PirateClient pclient, PirateMessage data) {
            Contract.Requires(host != null &amp;&amp; pclient != null &amp;&amp; data != null &amp;&amp; data.Head == PirateMessageHead.Init);
            var msg = new PirateMessage(PirateMessageHead.Init, WelcomePhrase);
            host.SendMessage(pclient, msg);
        }

        /// &lt;summary&gt;
        /// Client verification.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        /// &lt;param name=&quot;pclient&quot;&gt;The client.&lt;/param&gt;
        /// &lt;param name=&quot;data&quot;&gt;The data received from the client.&lt;/param&gt;
        public static void VerifyConnection(PirateHost host, PirateClient pclient, PirateMessage data) {
            Contract.Requires(host != null &amp;&amp; pclient != null &amp;&amp; data != null &amp;&amp; data.Head == PirateMessageHead.Verf);
            if(data.Body == WelcomePhrase) {
                GetPlayerInfo(host, pclient);
            }
        }

        /// &lt;summary&gt;
        /// Send error message.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        /// &lt;param name=&quot;pclient&quot;&gt;The client.&lt;/param&gt;
        /// &lt;param name=&quot;error&quot;&gt;The error.&lt;/param&gt;
        public static void ErrorMessage(PirateHost host, PirateClient pclient, PirateError error) {
            Contract.Requires(host != null &amp;&amp; pclient != null &amp;&amp; error != PirateError.Unknown);
            var msg = new PirateMessage(PirateMessageHead.Erro, error.ToString());
            host.SendMessage(pclient, msg);
        }

        /// &lt;summary&gt;
        /// Get player info.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        /// &lt;param name=&quot;pclient&quot;&gt;The client.&lt;/param&gt;
        public static void GetPlayerInfo(PirateHost host, PirateClient pclient) {
            Contract.Requires(host != null &amp;&amp; pclient != null);
            var msg = new PirateMessage(PirateMessageHead.Pnfo, &quot;&quot;);
            host.SendMessage(pclient, msg);
        }

        /// &lt;summary&gt;
        /// Set player info.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        /// &lt;param name=&quot;pclient&quot;&gt;The client.&lt;/param&gt;
        /// &lt;param name=&quot;data&quot;&gt;The data received from client.&lt;/param&gt;
        public static void SetPlayerInfo(PirateHost host, PirateClient pclient, PirateMessage data) {
            Contract.Requires(host != null &amp;&amp; pclient != null &amp;&amp; data != null &amp;&amp; data.Head == PirateMessageHead.Pnfo);
            var player = PirateMessage.GetPlayerName(data);
            if (player == null) return;

            if (!host.ContainsPlayer(player)) {
                if(host.Game.Contains(pclient)) host.Game.RemovePlayer(pclient);
                host.SetPlayerName(pclient, player);
                host.Game.ClearPlayers();
                host.Game.AddPlayers(host.GetPlayers());
                pclient.SetGame(host.Game);
                SendPlayerInfo(host);
            }else {
                var msg = new PirateMessage(PirateMessageHead.Erro, PirateError.NameAlreadyTaken.ToString());
                host.SendMessage(pclient, msg);
            }
        }

        /// &lt;summary&gt;
        /// Send player info.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        public static void SendPlayerInfo(PirateHost host) {
            Contract.Requires(host != null);

            var msg = new PirateMessage(PirateMessageHead.Pigm, PirateMessage.ConstructBody(host.GetPlayers().Select(player =&gt; player.ToString()).ToArray()));

            if (host.PlayerCount &gt; 0) {
                if(host.DebugMode) Console.WriteLine(&quot;Host: Players in game:&quot;);
                foreach (var player in host.GetPlayers()) {
                    if(host.DebugMode) Console.WriteLine(&quot;\t&quot; + player.Name);
                    host.SendMessage(player, msg);
                }
            }
        }

        /// &lt;summary&gt;
        /// Start game.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The game.&lt;/param&gt;
        public static void StartGame(PirateHost host) {
            Contract.Requires(host != null &amp;&amp; host.PlayerCount &gt;= 2);
            host.StopAccepting();

            var dealerIndex = CollectionFnc.PickRandom(0, host.Game.Players.Count - 1);
            Console.WriteLine(&quot;Starting player is: &quot; + host.Game.Players[dealerIndex].Name);

            var msg = new PirateMessage(PirateMessageHead.Gstr, PirateMessage.ConstructStartingPlayer(host.Game.Players[dealerIndex]));
            foreach(var pclient in host.GetPlayers()) {
                host.SendMessage(pclient, msg);
            }

            host.Game.Start(true, dealerIndex);
        }

        /// &lt;summary&gt;
        /// Game finished.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        public static void GameFinished(PirateHost host) {
            Contract.Requires(host != null);

            var body =
                PirateMessage.ConstructBody(
                    PirateMessage.ContstructPlayerScores(host.Game.GetTotalScores()));
            body = PirateMessage.AppendBody(body, PirateMessage.ConstructWinner(host.Game.Leader));
            var msg = new PirateMessage(PirateMessageHead.Gfin, body);

            foreach (var player in host.GetPlayers()) {
                host.SendMessage(player, msg);
            }
        }

        /// &lt;summary&gt;
        /// Deal card.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        /// &lt;param name=&quot;data&quot;&gt;Data received from client.&lt;/param&gt;
        public static void DealCard(PirateHost host, PirateMessage data) {
            Contract.Requires(host != null &amp;&amp; data != null &amp;&amp; data.Head == PirateMessageHead.Xcrd);
            var player = PirateMessage.GetPlayerName(data);
            if(player == null) {
                return;
            }

            var pclient = host.PlayerFromString(player);
            if(pclient == null) {
                return;
            }

            var card = Card.FromString(data.Body);
            if(card == null) {
                return;
            }

            pclient.GetCard(card);

            Console.WriteLine(&quot;Host: Sending card &quot; + card.ToShortString() + &quot; to &quot; + pclient);

            var msg = new PirateMessage(PirateMessageHead.Xcrd, card.ToString());
            host.SendMessage(pclient, msg);

            if(host.Game.Round.CardsDealt == host.Game.Round.TotalCards) {
                RequestBets(host);
            }
        }

        /// &lt;summary&gt;
        /// Request card from player.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        /// &lt;param name=&quot;pclient&quot;&gt;The player.&lt;/param&gt;
        public static void RequestCard(PirateHost host, PirateClient pclient) {
            Contract.Requires(host != null &amp;&amp; pclient != null);
            Console.WriteLine(&quot;Sending card request to &quot; + pclient.Name);
            var msg = new PirateMessage(PirateMessageHead.Creq, &quot;&quot;);
            host.SendMessage(pclient, msg);
        }

        /// &lt;summary&gt;
        /// Play card from player.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        /// &lt;param name=&quot;data&quot;&gt;Data received from client.&lt;/param&gt;
        public static void PlayCard(PirateHost host, PirateMessage data) {
            Contract.Requires(host != null &amp;&amp; data != null &amp;&amp; data.Head == PirateMessageHead.Pcrd);
            var playerName = PirateMessage.GetPlayerName(data);
            var player = host.PlayerFromString(playerName);
            var card = Card.FromString(data.Body);

            if(!player.CardPlayable(card, host.Game.Round.BoardCards.FirstCard)) {
                ErrorMessage(host, player, PirateError.CardNotPlayable);
                var returnCard = new PirateMessage(PirateMessageHead.Xcrd, card.ToString());
                host.SendMessage(player, returnCard);
                RequestCard(host, player);
                return;
            }

            Console.WriteLine(player.Name + &quot; plays &quot; + card.ToShortString());

            var msg = new PirateMessage(
                PirateMessageHead.Pcrd, PirateMessage.ConstructBody(player.ToString(), card.ToString()));

            foreach(var pclient in host.GetPlayers()) {
                host.SendMessage(pclient, msg);
            }

            player.PlayCard(card);
            //host.Game.Round.PlayCard(player, card);
            if(!host.Game.Round.Finished) {
                RequestCard(host, host.PlayerFromIndex(host.Game.Round.CurrentPlayer));
            }else {
                host.Game.NewRound();
            }
        }

        /// &lt;summary&gt;
        /// Request bets from players.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        public static void RequestBets(PirateHost host) {
            Contract.Requires(host != null);

            var msg = new PirateMessage(PirateMessageHead.Breq, &quot;&quot;);
            foreach(var pclient in host.GetPlayers()) {
                host.SendMessage(pclient, msg);
            }
        }

        /// &lt;summary&gt;
        /// Receive bet from player.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        /// &lt;param name=&quot;player&quot;&gt;The client.&lt;/param&gt;
        /// &lt;param name=&quot;msg&quot;&gt;The data received from the client.&lt;/param&gt;
        public static void ReceiveBet(PirateHost host, PirateClient player, PirateMessage msg) {
            Contract.Requires(host != null &amp;&amp; player != null &amp;&amp; msg != null &amp;&amp; msg.Head == PirateMessageHead.Pbet &amp;&amp; host.Game.Round.AwaitingBets);

            lock (host.Game.Round) {
                var bet = 0;
                if (int.TryParse(msg.Body, out bet)) {
                    player.SetBet(bet);
                } else {
                    ErrorMessage(host, player, PirateError.InvalidBet);
                }

                if (host.Game.Round.BetsDone) {
                    BeginRound(host);
                }
            }
        }

        /// &lt;summary&gt;
        /// New round.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        public static void NewRound(PirateHost host) {
            Contract.Requires(host != null);

            var body =
                PirateMessage.ConstructBody(
                    PirateMessage.ConstructDealer(host.Game.Players[host.Game.Round.Dealer].Name),
                    PirateMessage.ConstructRoundNumber(host.Game.CurrentRound));
            var msg = new PirateMessage(PirateMessageHead.Nrnd, body);
            foreach (var pclient in host.GetPlayers()) {
                host.SendMessage(pclient, msg);
            }
            Console.WriteLine(&quot;Starting new round: &quot; + host.Game.CurrentRound);
        }

        /// &lt;summary&gt;
        /// Begin round.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        public static void BeginRound(PirateHost host) {
            Contract.Requires(host != null &amp;&amp; host.Game.Round.BetsDone);

            var bets = new HashSet&lt;string&gt;();
            foreach(var player in host.GetPlayers()) {
                bets.Add(PirateMessage.ConstructPlayerBet(player));
            }
            bets.Add(PirateMessage.ConstructRoundNumber(host.Game.CurrentRound));

            var msg = new PirateMessage(PirateMessageHead.Bgrn, PirateMessage.ConstructBody(bets));

            foreach(var player in host.GetPlayers()) {
                host.SendMessage(player, msg);
            }
            lock (host.Game.Round) {
                host.Game.Round.Begin();
            }
        }

        /// &lt;summary&gt;
        /// New pile.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        public static void NewPile(PirateHost host) {
            Contract.Requires(host != null);

            var body = PirateMessage.ConstructBody(PirateMessage.ConstructPlayerTricks(host.Game.Round));
            body = PirateMessage.AppendBody(body, PirateMessage.ConstructWinner(host.Game.Round.LastTrick.Winner));
            var msg = new PirateMessage(PirateMessageHead.Trdn, body);

            foreach(var player in host.GetPlayers()) {
                host.SendMessage(player, msg);
            }
        }

        /// &lt;summary&gt;
        /// Round finished.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;host&quot;&gt;The host.&lt;/param&gt;
        public static void RoundFinished(PirateHost host) {
            Contract.Requires(host != null);

            var body =
                PirateMessage.ConstructBody(
                    PirateMessage.ContstructPlayerScores(host.Game.GetRoundScoreTotal(host.Game.CurrentRound)));
            var msg = new PirateMessage(PirateMessageHead.Frnd, body);

            foreach (var player in host.GetPlayers()) {
                host.SendMessage(player, msg);
            }
        }
    }
}
</pre></code><script type="text/javascript">
			applyranges('src109', RANGES_109)
		</script>
	</body>
</html>