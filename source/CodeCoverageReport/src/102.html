<html>
	<head>
		<script type="text/javascript" src="../js/coverreport.js">

		</script><script type="text/javascript">
			RANGES_102 = [
   [57,17,57,18,'dccv']
, [58,17,58,35,'dccv']
, [59,13,59,14,'dccv']
, [66,17,66,18,'dccv']
, [67,17,69,32,'dccv']
, [70,13,70,14,'dccv']
, [112,13,112,45,'dccv']
, [111,9,111,35,'dccv']
, [111,36,111,37,'dccv']
, [113,13,113,30,'dccv']
, [114,13,114,48,'dccv']
, [115,13,115,53,'dccv']
, [116,13,116,35,'dccv']
, [117,13,117,31,'dccv']
, [118,9,118,10,'dccv']
, [123,35,123,36,'dccv']
, [124,13,124,30,'dccv']
, [124,31,124,32,'dccv']
, [125,17,125,62,'dccv']
, [126,13,126,14,'dccv']
, [127,9,127,10,'dccv']
, [134,13,134,45,'dccv']
, [133,40,133,41,'dccv']
, [135,13,135,30,'dccv']
, [135,31,135,32,'dccv']
, [136,17,136,38,'dccv']
, [137,13,137,14,'dccv']
, [138,13,138,31,'dccv']
, [139,9,139,10,'dccv']
, [146,13,146,74,'dccv']
, [146,13,146,74,'dccv']
, [145,43,145,44,'dccv']
, [147,13,147,30,'dccv']
, [147,31,147,32,'dccv']
, [148,17,148,41,'dccv']
, [149,13,149,14,'dccv']
, [150,13,150,31,'dccv']
, [151,9,151,10,'dccv']
, [166,13,166,127,'dccv']
, [166,13,166,127,'dccv']
, [165,41,165,42,'dccv']
, [168,13,168,31,'dccv']
, [169,13,169,45,'dccv']
, [170,13,170,35,'dccv']
, [171,13,171,35,'dccv']
, [171,36,171,53,'dccv']
, [172,9,172,10,'dccv']
, [167,13,167,104,'dccv']
, [167,13,167,104,'dccv']
, [178,13,178,57,'dccv']
, [178,13,178,57,'dccv']
, [177,33,177,34,'dccv']
, [179,13,179,47,'dccv']
, [180,13,180,71,'dccv']
, [181,17,181,27,'dccv']
, [181,76,181,77,'dccv']
, [182,17,182,39,'dccv']
, [183,17,183,52,'dccv']
, [184,17,184,39,'dccv']
, [184,40,184,78,'dccv']
, [185,17,185,60,'dccv']
, [186,13,186,14,'dccv']
, [181,71,181,74,'dccv']
, [181,28,181,69,'dccv']
, [187,9,187,10,'dccv']
, [210,13,210,47,'dccv']
, [211,13,211,53,'dccv']
, [209,63,209,64,'dccv']
, [212,13,212,105,'dccv']
, [213,9,213,10,'dccv']
, [221,42,221,43,'dccv']
, [222,13,222,34,'dccv']
, [222,48,222,50,'dccv']
, [223,9,223,10,'dccv']
, [231,40,231,41,'dccv']
, [232,13,232,25,'dccv']
, [232,26,232,27,'dccv']
, [233,17,233,50,'dccv']
, [235,9,235,10,'dccv']
, [242,13,242,62,'dccv']
, [242,13,242,62,'dccv']
, [241,37,241,38,'dccv']
, [243,13,243,28,'dccv']
, [244,13,244,50,'dccv']
, [245,13,245,31,'dccv']
, [245,32,245,44,'dccv']
, [246,9,246,10,'dccv']
, [253,13,253,45,'dccv']
, [252,40,252,41,'dccv']
, [254,13,254,30,'dccv']
, [255,9,255,10,'dccv']
, [263,13,263,120,'dccv']
, [262,39,262,40,'dccv']
, [263,13,263,120,'dccv']
, [263,13,263,120,'dccv']
, [264,13,264,34,'dccv']
, [265,13,265,56,'dccv']
, [265,57,265,58,'dccv']
, [266,17,266,24,'dccv']
, [266,38,266,62,'dccv']
, [266,123,266,124,'dccv']
, [266,26,266,34,'dccv']
, [266,126,266,127,'dccv']
, [267,21,267,35,'dccv']
, [268,21,268,27,'dccv']
, [266,35,266,37,'dccv']
, [270,13,270,14,'dccv']
, [271,13,271,27,'dccv']
, [272,9,272,10,'dccv']
, [266,62,266,123,'dccv']
, [284,40,284,41,'dccv']
, [285,13,285,71,'dccv']
, [285,13,285,71,'dccv']
, [286,13,286,61,'dccv']
, [286,13,286,61,'dccv']
, [222,34,222,48,'dccv']
, [156,33,156,34,'dcuc']
, [157,13,157,32,'dcuc']
, [158,13,158,31,'dcuc']
, [159,9,159,10,'dcuc']
, [196,13,196,47,'dcuc']
, [197,13,197,53,'dcuc']
, [198,13,198,77,'dcuc']
, [198,13,198,77,'dcuc']
, [195,47,195,48,'dcuc']
, [199,13,199,74,'dcuc']
, [200,9,200,10,'dcuc']
, [279,43,279,44,'dcuc']
, [280,13,280,25,'dcuc']
, [281,9,281,10,'dcuc']
];
		</script><link rel="stylesheet" type="text/css" href="../css/coverreport.css" />
	</head><body>
		<code id="src102" class="dotCoverSource"><pre>// &lt;copyright file=&quot;Player.cs&quot;&gt;
//      ahal@itu.dk
// &lt;/copyright&gt;
// &lt;summary&gt;
//      A representation of a player in the Pirate Spades Game.
// &lt;/summary&gt;
// &lt;author&gt;Andreas Hallberg Kjeldsen (ahal@itu.dk)&lt;/author&gt;

namespace PirateSpades.GameLogic {
    using System.Collections.Generic;
    using System.Diagnostics.Contracts;
    using System.Linq;

    /// &lt;summary&gt;
    /// A representation of a player in the Pirate Spades Game.
    /// &lt;/summary&gt;
    public class Player {
        /// &lt;summary&gt;
        /// The game the player is playing in.
        /// &lt;/summary&gt;
        public Game Game { get; private set; }

        /// &lt;summary&gt;
        /// The name of the player.
        /// &lt;/summary&gt;
        public string Name { get; protected set; }

        /// &lt;summary&gt;
        /// The amount the player bet.
        /// &lt;/summary&gt;
        public int Bet { get; private set; }

        /// &lt;summary&gt;
        /// Whether or not the player is the current dealer.
        /// &lt;/summary&gt;
        public bool IsDealer { get; set; }

        /// &lt;summary&gt;
        /// The card the player wishes to play.
        /// &lt;/summary&gt;
        public Card CardToPlay { get; private set; }

        /// &lt;summary&gt;
        /// The hand of the player.
        /// &lt;/summary&gt;
        public IList&lt;Card&gt; Hand { get; protected set; }

        /// &lt;summary&gt;
        /// The cards on hand of the player, sorted 2, 3 -&gt; King, Ace and Diamonds, Clubs, Hearts, Spades.
        /// &lt;/summary&gt;
        protected SortedSet&lt;Card&gt; Cards { get; set; }

        /// &lt;summary&gt;
        /// Amount of cards on hand.
        /// &lt;/summary&gt;
        public int CardsOnHand {
            get {
                return Hand.Count;
            }
        }

        /// &lt;summary&gt;
        /// Amount of tricks in the current round.
        /// &lt;/summary&gt;
        public int Tricks {
            get {
                return Game != null &amp;&amp; Game.Started &amp;&amp; Game.CurrentRound &gt;= 1 &amp;&amp; Game.GetRound(Game.CurrentRound).Started &amp;&amp; Game.Round.PlayerTricks.ContainsKey(this)
                           ? Game.Round.PlayerTricks[this].Count
                           : 0;
            }
        }

        /// &lt;summary&gt;
        /// Delegate for when a card has been played.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;c&quot;&gt;The card played.&lt;/param&gt;
        protected delegate void CardPlayedDelegate(Card c);

        /// &lt;summary&gt;
        /// Delegate for when a card has been dealt.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;p&quot;&gt;The receiving players.&lt;/param&gt;
        /// &lt;param name=&quot;c&quot;&gt;The card dealt.&lt;/param&gt;
        protected delegate void CardDealtDelegate(Player p, Card c);

        /// &lt;summary&gt;
        /// Delegate for when a bet has been set.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;bet&quot;&gt;The bet set.&lt;/param&gt;
        protected delegate void BetSetDelegate(int bet);

        /// &lt;summary&gt;
        /// Fires when a card has been played.
        /// &lt;/summary&gt;
        protected event CardPlayedDelegate CardPlayed;

        /// &lt;summary&gt;
        /// Fires when a card has been dealt.
        /// &lt;/summary&gt;
        protected event CardDealtDelegate CardDealt;

        /// &lt;summary&gt;
        /// Fires when a bet has been set.
        /// &lt;/summary&gt;
        protected event BetSetDelegate BetSet;

        /// &lt;summary&gt;
        /// Constructor.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;name&quot;&gt;The name of the player.&lt;/param&gt;
        public Player(string name) {
            Contract.Requires(name != null);
            this.Name = name;
            this.Cards = new SortedSet&lt;Card&gt;();
            this.Hand = Cards.ToList().AsReadOnly();
            this.IsDealer = false;
            this.UpdateHand();
        }

        /// &lt;summary&gt;
        /// Update the hand.
        /// &lt;/summary&gt;
        private void UpdateHand() {
            lock (this.Cards) {
                this.Hand = this.Cards.ToList().AsReadOnly();
            }
        }

        /// &lt;summary&gt;
        /// Receive a card.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;card&quot;&gt;The card to receive.&lt;/param&gt;
        public void GetCard(Card card) {
            Contract.Requires(card != null);
            lock (this.Cards) {
                this.Cards.Add(card);
            }
            this.UpdateHand();
        }

        /// &lt;summary&gt;
        /// Remove card from hand.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;card&quot;&gt;The card to remove.&lt;/param&gt;
        public void RemoveCard(Card card) {
            Contract.Requires(card != null &amp;&amp; this.Cards.Contains(card));
            lock (this.Cards) {
                this.Cards.Remove(card);
            }
            this.UpdateHand();
        }

        /// &lt;summary&gt;
        /// Clear the cards on hand.
        /// &lt;/summary&gt;
        public void ClearHand() {
            this.Cards.Clear();
            this.UpdateHand();
        }

        /// &lt;summary&gt;
        /// Play a card.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;card&quot;&gt;The card to play.&lt;/param&gt;
        public void PlayCard(Card card) {
            Contract.Requires(card != null &amp;&amp; this.HasCard(card) &amp;&amp; this.CardPlayable(card, Game.Round.BoardCards.FirstCard));
            Contract.Ensures(!this.HasCard(card) &amp;&amp; CardsOnHand == Contract.OldValue(CardsOnHand) - 1);
            CardToPlay = card;
            Game.Round.PlayCard(this, card);
            this.RemoveCard(card);
            if(CardPlayed != null) CardPlayed(card);
        }

        /// &lt;summary&gt;
        /// Deal cards.
        /// &lt;/summary&gt;
        public void DealCards() {
            Contract.Requires(IsDealer &amp;&amp; Game != null);
            var deck = Deck.GetShuffledDeck();
            var dealTo = (Game.Round.Dealer + 1) % Game.Players.Count;
            for(var i = 0; i &lt; Game.CardsToDeal * Game.Players.Count; i++) {
                var card = deck.Pop();
                Game.Players[dealTo].GetCard(card);
                if (CardDealt != null) CardDealt(Game.Players[dealTo], card);
                dealTo = (dealTo + 1) % Game.Players.Count;
            }
        }

        /// &lt;summary&gt;
        /// Checks whether or not a card is playable.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;toPlay&quot;&gt;The card to play.&lt;/param&gt;
        /// &lt;returns&gt;True if the card is playable, false if not.&lt;/returns&gt;
        [Pure]
        public bool CardPlayable(Card toPlay) {
            Contract.Requires(toPlay != null);
            Contract.Requires(this.HasCard(toPlay));
            Contract.Requires(this.Game.Started &amp;&amp; this.Game.Round != null);
            return CardPlayable(toPlay, Game.Round.BoardCards.FirstCard);
        }

        /// &lt;summary&gt;
        /// Checks whether or not a card is playable.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;toPlay&quot;&gt;The card to play.&lt;/param&gt;
        /// &lt;param name=&quot;mustMatch&quot;&gt;The card it must match.&lt;/param&gt;
        /// &lt;returns&gt;True if the card is playable, false if not.&lt;/returns&gt;
        [Pure]
        public bool CardPlayable(Card toPlay, Card mustMatch) {
            Contract.Requires(toPlay != null);
            Contract.Requires(this.HasCard(toPlay));
            return mustMatch == null || (!this.HasCardOf(mustMatch.Suit) || toPlay.SameSuit(mustMatch));
        }

        /// &lt;summary&gt;
        /// Checks whether or not the player has a card of the specified suit.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;suit&quot;&gt;The suit to check for.&lt;/param&gt;
        /// &lt;returns&gt;True if the player has a card of the specified suit, false if not.&lt;/returns&gt;
        [Pure]
        public bool HasCardOf(Suit suit) {
            return Hand.Any(c =&gt; c.Suit == suit);
        }

        /// &lt;summary&gt;
        /// Checks whether or not the player has the specified card.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;card&quot;&gt;The card.&lt;/param&gt;
        /// &lt;returns&gt;True if the player has the specified card.&lt;/returns&gt;
        [Pure]
        public bool HasCard(Card card) {
            lock (Cards) {
                return this.Cards.Contains(card);
            }
        }

        /// &lt;summary&gt;
        /// Set the bet for the player.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;bet&quot;&gt;The bet.&lt;/param&gt;
        public void SetBet(int bet) {
            Contract.Requires(this.Game != null &amp;&amp; bet &gt;= 0);
            this.Bet = bet;
            this.Game.Round.PlayerBet(this, bet);
            if(BetSet != null) BetSet(bet);
        }

        /// &lt;summary&gt;
        /// Set the game for the player.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;game&quot;&gt;The game.&lt;/param&gt;
        public void SetGame(Game game) {
            Contract.Requires(game != null);
            this.Game = game;
        }

        /// &lt;summary&gt;
        /// Get a playable card.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;The first playable card.&lt;/returns&gt;
        [Pure]
        public Card GetPlayableCard() {
            Contract.Requires(Game != null &amp;&amp; Game.Active &amp;&amp; !Game.Round.BoardCards.HasPlayed(this) &amp;&amp; Hand.Count &gt; 0);
            var toPlay = Hand[0];
            if(Game.Round.BoardCards.FirstCard != null) {
                foreach (var card in this.Hand.Where(card =&gt; this.CardPlayable(card, this.Game.Round.BoardCards.FirstCard))) {
                    toPlay = card;
                    break;
                }
            };
            return toPlay;
        }

        /// &lt;summary&gt;
        /// Get a textual representation of the player.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;A textual representation of the player.&lt;/returns&gt;
        [Pure]
        public override string ToString() {
            return Name;
        }

        [ContractInvariantMethod]
        private void ObjectInvariant() {
            Contract.Invariant(CardsOnHand &gt;= 0 &amp;&amp; CardsOnHand &lt;= 10);
            Contract.Invariant(Tricks &gt;= 0 &amp;&amp; Tricks &lt;= 10);
        }
    }
}
</pre></code><script type="text/javascript">
			applyranges('src102', RANGES_102)
		</script>
	</body>
</html>